<!DOCTYPE HTML>
<html lang="en">

<head>
    <title>Test List</title>
    <script src="src/test-files.js"></script>
    <style>
        body {
            padding: 20px 20px 100px 20px;
            font-family: sans-serif;
        }
    </style>
</head>

<body>
    <h1>Test List</h1>
    <div id="mocha"></div>
    <input style="margin-bottom: 10px;" />
    <div id="tests">
    </div>
    <script>

        mocha.setup('tdd');

        suite('List', function () {
            this.timeout(3000);
            const
                suite = window.suite,
                test = window.test,
                dom = window.dom,
                on = window.on,
                expect = chai.expect,
                body = dom.byId('tests'),
                data = [
                    {label: 'Orange', value: 'orange'},
                    {label: 'Red', value: 'red', selected: true},
                    {label: 'Blue', value: 'blue'},
                    {label: 'Green', value: 'green'}
                ],
                data2 = [
                    {label: 'Puppy', value: 'puppy'},
                    {label: 'Birdy', value: 'birdy', selected: true},
                    {label: 'Kitty', value: 'kitty'},
                    {label: 'Snakey', value: 'snakey'}
                ];

            let node;

            function click(index) {
                const lis = dom.queryAll(node.popup, 'li');
                node.once('open', function () {
                    on.emit(lis[index], 'click');
                });
                on.emit(node.button, 'click');
            }

            function select(index, eventName) {
                eventName = eventName || 'change';
                return new Promise(function (resolve) {
                    node.once(eventName, function (e) {
                        resolve(e);
                    });
                    node.once('open', function () {
                        on.emit(node.popup.children[index], 'click');
                    });
                    on.emit(node.button, 'click');
                });
            }

            function key (k) {
                console.log('key...');
                on.emit(node.list, 'keydown', {key: k});
            }

            suite('Single Select', function () {

                test.only('it should render a simple, selectable list', function (done) {
                    node = dom('ui-list', {data: data, readonly: true, disabled: false, label: 'Read Only List'}, body);
                    onDomReady(node, function () {
                        // const spy = chai.spy(foo);
                        const items = dom.queryAll(node, 'li');
                        let value;
                        on(node, 'change', function(e){
                            value = e.value;
                            console.log('change:', e.value);
                        });
                        node.list.focus();
                        console.log('active:', document.activeElement);

                        key('ArrowDown');
                        expect(items[1].getAttribute('aria-current')).to.equal("true");
                        key('ArrowDown');
                        key('Enter');
                        expect(items[2].getAttribute('aria-selected')).to.equal("true");
                        done();
                    });
                });

                test('it should render readonly and with a label', function (done) {
                    
                });

                test('it should render with lazy data', function (done) {

                });

                test('it should render a disabled list', function (done) {

                });

                test('it should render custom items', function (done) {

                });

                test('it should programmatically set a value', function (done) {

                });

            });

            suite('Multi Select', function () {
                test('it should programmatically set a value', function (done) {

                });
            });
        });

        mocha.run();

    </script>

</body>

</html>
